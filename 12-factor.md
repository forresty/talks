# 使用 12-factor 的理念快速创建高可维护性的应用

12-factor (http://12factor.net) 是 Heroku 创始人 Adam Wiggins 提出来的 12 条理念，基于这套理念开发团队可以快速高效地开发出具有高可维护性的互联网应用。

自2012年这个理念被提出后以来，已经有许多团队在实战中或者学习或者自行摸索出12条中的若干部分，所以这些理念对于在座诸位可能并不陌生。

然而部分大公司有非常严格的开发流程导致必须有专人进行维护，部分创业公司为了快速开发放弃了这些准则中的一部分从而反过来对自己的应用的稳定高效造成了负面的影响

在这里，我们想通过分享我们在小团队快速开发的背景下，如何灵活地应用这些准则，并且引入我们自己的思考，从而提高开发和运维的效率

## 12 factors

1. 一个应用使用一个代码存储，整个系统由多个应用组成，基于 microservices 架构实现
2. 显式声明应用使用的依赖，每个应用应该可以完全独立部署，不受系统环境影响 (ruby Gemfile, docker 技术)
3. 配置通过 Unix 环境变量注入，以实现依赖翻转 (ruby .env, chef?)
4. 依赖的服务声明成资源，如数据库连接、Redis 连接，支撑前端 API 的 后端 HTTP/Thrift Services 等
5. 严格区分 build 和 run 的环境（预编译资源文件 rails assets)
6. 除了持久化的存储服务之外，其他服务都应该是无状态的，不共享任何数据
7. 通过绑定端口对外暴露服务。在前端通过 7-layer-aware TCP proxy 实现和后端 microservices 的对接 (ruby proxymachine)
8. 通过多进程服务模型进行应用扩容，这样可以很容易扩展到多台服务器
9. 快速启动，优雅关闭，不中端服务热部署 (unicorn -HUP signal)
10. 让开发、测试和部署环境越接近越好 持续集成 (ruby integrity)
11. 把 log 当成事件流处理，而不是文件。使用 hadoop, logstash 或者 papertrail 云服务集中处理和分析日志
12. 系统管理任务应该作为一次性的任务执行
